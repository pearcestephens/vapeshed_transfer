# Project File Audit – 2025-10-04

Scope: Repository working tree (not git history). Catalog of concrete inconsistencies and safe corrections performed. Each item includes evidence, fix, and rollback.

## A1. API bootstrap include path incorrect
- Evidence: `public/api/transfer.php` and `public/api/pricing.php` used `dirname(__DIR__) . '/app/bootstrap.php'` which resolves to `transfer_engine/public/app/bootstrap.php` (non-existent). Correct path is `transfer_engine/app/bootstrap.php`.
- Fix: Updated both files to `require_once dirname(__DIR__, 2) . '/app/bootstrap.php';`
- Rollback: Change the require back to prior form (not recommended).

## A2. Navbar modules config retrieval incomplete
- Evidence: `public/views/partials/navbar.php` calls `config('modules', [])`, but `app/bootstrap.php` only handled `modules.<slug>` keys. Menu could render empty.
- Fix: In `app/bootstrap.php`, added handling for exact key `modules` to return the loaded modules array.
- Rollback: Remove that conditional branch.

## A3. Duplicate/Confusing SSE endpoints
- Evidence: Two SSE files exist: `transfer_engine/public/sse.php` (active) and `unified/public/sse.php` (stale placeholder referencing non-existent classes).
- Fix: Marked `unified/public/sse.php` as deprecated shim delegating to `transfer_engine/public/sse.php` to avoid 404/confusion.
- Rollback: Restore original unified SSE content.

## A4. PricingReadModel method name drift in docs
- Evidence: Spec referenced `bandStats()` which isn’t implemented; file provides `sevenDayStats()`.
- Fix: Corrected Section 47.1 in `docs/PROJECT_SPECIFICATION.md` and added Section 48 with API/SSE contracts.
- Rollback: Revert doc changes.

---
All changes are backward-compatible, minimal, and reversible in a single commit. No features added; only repaired inconsistencies.

## A5. Duplicate statusBadge helper (drift risk)
- Evidence: statusBadge implemented in both `app/bootstrap.php` and `public/views/helpers/stats.php`.
- Fix: Removed bootstrap copy; rely on helpers file to avoid future drift.
- Rollback: Reintroduce function into bootstrap (not recommended).

## A6. SSE observability endpoint
- Evidence: Need to introspect current SSE capacity state.
- Fix: Added `public/health_sse.php` returning current lock counts (global + per IP) for lightweight ops checks.
- Rollback: Remove the file.
